---
layout: post
title: 基于 OPC UA 统一能源信息模型
tags: [opcua,energy]
categories: [technology]
---
<p>
最近看到德国汉堡 Helmut Schmidt 大学亚历山大·费教授团队的一篇论文，讨论怎么通过 OPC UA 构建统一的能源信息管理系统。
</p>

<p>
整体架构是这样子的：
</p>


<div id="org415bd19" class="figure">
<p><div align="center"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->

<svg
   version="1.1"
   id="svg2"
   xml:space="preserve"
   width="500.16"
   height="368"
   viewBox="0 0 500.16 368"
   sodipodi:docname="Universal-Energy-Information-Model.drawio.pdf"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"><defs
     id="defs6"><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath16"><path
         d="M 0,0 H 1562.5 V 1147.2275 H 0 Z"
         clip-rule="evenodd"
         id="path14" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath28"><path
         d="M 0,0 H 1562.5 V 1144.24 H 0 Z"
         clip-rule="evenodd"
         id="path26" /></clipPath></defs><sodipodi:namedview
     id="namedview4"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0" /><g
     id="g8"
     inkscape:groupmode="layer"
     inkscape:label="Universal-Energy-Information-Model.drawio"
     transform="matrix(0.31999998,0,0,0.31999998,0,9.2e-6)"><g
       id="g10"><g
         id="g12"
         clip-path="url(#clipPath16)"><g
           id="g18"
           transform="scale(2.9875717)"><path
             d="M 0,0 H 523 V 384 H 0 Z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path20" /></g></g></g><g
       id="g22"><g
         id="g24"
         clip-path="url(#clipPath28)"><g
           id="g30"
           transform="matrix(2.9875717,0,0,2.9875717,1.4937859,1.4937859)"><path
             d="M 41,321 V 241"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path32" /><path
             d="m 1,321 h 80 v 60 H 1 Z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path34" /><path
             d="m 1,321 h 80 v 60 H 1 Z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path36" /></g><g
           id="g38"
           transform="scale(2.9875717)"><text
             transform="translate(18.4375,356)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text42"><tspan
               x="0 3.8896484 14.779297 19.441406 27.227539 30.337891 38.124023"
               y="0"
               sodipodi:role="line"
               id="tspan40">IO-Link</tspan></text></g><g
           id="g44"
           transform="matrix(2.9875717,0,0,2.9875717,1.4937859,1.4937859)"><path
             d="M 121,321 V 241"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path46" /><path
             d="m 81,321 h 80 v 60 H 81 Z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path48" /><path
             d="m 81,321 h 80 v 60 H 81 Z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path50" /></g><g
           id="g52"
           transform="scale(2.9875717)"><text
             transform="translate(96.09375,348)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text56"><tspan
               x="0 11.662109 19.448242 27.234375 35.020508 42.806641"
               y="0"
               sodipodi:role="line"
               id="tspan54">Modbus</tspan></text><text
             transform="translate(107,365)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text60"><tspan
               x="0 8.5517578 18.662109"
               y="0"
               sodipodi:role="line"
               id="tspan58">TCP</tspan></text></g><g
           id="g62"
           transform="matrix(2.9875717,0,0,2.9875717,1.4937859,1.4937859)"><path
             d="M 201,321 V 241"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path64" /><path
             d="m 161,321 h 80 v 60 h -80 z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path66" /><path
             d="m 161,321 h 80 v 60 h -80 z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path68" /></g><g
           id="g70"
           transform="scale(2.9875717)"><text
             transform="translate(165.20312,348)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text74"><tspan
               x="0 9.3378906 19.448242 30.337891 38.889648 42.779297 52.117188 62.227539"
               y="0"
               sodipodi:role="line"
               id="tspan72">PROFIBUS</tspan></text><text
             transform="translate(191.26563,365)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text78"><tspan
               x="0 10.110352"
               y="0"
               sodipodi:role="line"
               id="tspan76">DP</tspan></text></g><g
           id="g80"
           transform="matrix(2.9875717,0,0,2.9875717,1.4937859,1.4937859)"><path
             d="M 281,321 V 241"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path82" /><path
             d="m 241,321 h 80 v 60 h -80 z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path84" /><path
             d="m 241,321 h 80 v 60 h -80 z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path86" /></g><g
           id="g88"
           transform="scale(2.9875717)"><text
             transform="translate(245.60938,356)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text92"><tspan
               x="0 9.3378906 19.448242 30.337891 38.889648 42.779297 52.889648 62.227539"
               y="0"
               sodipodi:role="line"
               id="tspan90">PROFINET</tspan></text></g><g
           id="g94"
           transform="matrix(2.9875717,0,0,2.9875717,1.4937859,1.4937859)"><path
             d="m 361,321 v -40 l -0.79999,-40.64"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path96" /><path
             d="m 321,321 h 80 v 60 h -80 z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path98" /><path
             d="m 321,321 h 80 v 60 h -80 z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path100" /></g><g
           id="g102"
           transform="scale(2.9875717)"><text
             transform="translate(355.15625,356)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text106"><tspan
               x="0 3.8896484 7.7792969"
               y="0"
               sodipodi:role="line"
               id="tspan104">...</tspan></text></g><g
           id="g108"
           transform="matrix(2.9875717,0,0,2.9875717,1.4937859,1.4937859)"><path
             d="M 480.95999,321 V 61"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path110" /><path
             d="m 441,321 h 80 v 60 h -80 z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path112" /><path
             d="m 441,321 h 80 v 60 h -80 z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path114" /></g><g
           id="g116"
           transform="scale(2.9875717)"><text
             transform="translate(468.92188,348)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text120"><tspan
               x="0 3.8896484 7.7792969 15.56543"
               y="0"
               sodipodi:role="line"
               id="tspan118">IIoT</tspan></text><text
             transform="translate(459.59375,365)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text124"><tspan
               x="0 10.110352 17.896484 24.896484 28.006836 35.006836"
               y="0"
               sodipodi:role="line"
               id="tspan122">Device</tspan></text></g><g
           id="g126"
           transform="matrix(2.9875717,0,0,2.9875717,1.4937859,1.4937859)"><path
             d="m 201,161 v -50 l 0.2,-50.66"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path128" /><path
             d="m 1,161 h 400 v 80 H 1 Z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path130" /><path
             d="m 1,161 h 400 v 80 H 1 Z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path132" /><path
             d="m 41,171 h 120 v 60 H 41 Z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path134" /><path
             d="m 41,171 h 120 v 60 H 41 Z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path136" /></g><g
           id="g138"
           transform="scale(2.9875717)"><text
             transform="translate(87.375,206)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text142"><tspan
               x="0 9.3378906 17.124023"
               y="0"
               sodipodi:role="line"
               id="tspan140">PLC</tspan></text></g><g
           id="g144"
           transform="matrix(2.9875717,0,0,2.9875717,1.4937859,1.4937859)"><path
             d="m 241,171 h 120 v 60 H 241 Z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path146" /><path
             d="m 241,171 h 120 v 60 H 241 Z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path148" /></g><g
           id="g150"
           transform="scale(2.9875717)"><text
             transform="translate(284.64063,206)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text154"><tspan
               x="0 9.3378906 17.124023 24.910156"
               y="0"
               sodipodi:role="line"
               id="tspan152">Edge</tspan></text></g><g
           id="g156"
           transform="matrix(2.9875717,0,0,2.9875717,1.4937859,1.4937859)"><path
             d="M 1,1 H 521 V 61 H 1 Z"
             style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="path158" /><path
             d="M 1,1 H 521 V 61 H 1 Z"
             style="fill:none;stroke:#000000;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             id="path160" /></g><g
           id="g162"
           transform="scale(2.9875717)"><text
             transform="translate(160.20312,36)"
             style="font-variant:normal;font-weight:normal;font-size:14px;font-family:Arial;-inkscape-font-specification:ArialMT;writing-mode:lr-tb;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none"
             id="text166"><tspan
               x="0 9.3378906 17.124023 24.910156 29.572266 37.358398 44.358398 48.248047 59.910156 67.696289 75.482422 83.268555 91.054688 98.84082 110.50293 118.28906 126.0752 129.96484 133.08203 142.41992 150.20605 157.99219 161.10254 164.21289 171.21289 178.99902 182.88867 185.99902 193.78516"
               y="0"
               sodipodi:role="line"
               id="tspan164">Energy Management Application</tspan></text></g></g></g></g></svg>
</div>
</p>
</div>

<p>
能源管理应用通过 OPC UA 或 MQTT 遥测多种现场设备，支持 IO-Link、Modbus
TCP、PROFIBUS DP、PROFINET 等协议。 为了能够在上层应用层获取统一结构的数据，边缘层将多种协议的能源设备数据转换为 O PC UA 信息模型。然后上层应用就能够在边缘层查询需要订阅的信息，一旦建立订阅关系，就通过 MQTT 这种
Pub/Sub 协议传输变量。
</p>

<p>
本文的要点有这几个：
</p>
<ol class="org-ol">
<li>如何妥善处理现场多种类型设备多源异构的总线协议</li>
<li>如何在边缘侧进行语义映射</li>
<li>如何结合 OPC UA 和 MQTT</li>
</ol>


<p>
现场设备有两种情况，一种是原始数据，需要手工建立这些测量数据到 OPC UA
信息模型的映射，还有一种是基于 OPC UA 伙伴协议。对于后者，目前
PROFIenergy，sercos Energy，CIP Energy 等现场总线的能源规范集是有对应的 OPC UA CS，这样就可以根据 Nodeset 文件建立数据映射。
</p>

<p>
数据映射的过程是通过边缘所谓的 UEIM 统一能源信息模型进行关联。主要用到了 OPC UA 信息模型中的测量数据类型（MeasuremetnValueType），包含了工程单元、精度类型、精度范围、测量标识、设备资源标识等。
</p>

<p>
因为 MQTT 并不提供数据的语义模型，只有订阅主题 Topic，所以首先在能源应用与边缘之间建立客户端/服务端通道，读取 OPC UA 地址空间信息模型，然后以 MQTT 订阅主题传输测量数据。
</p>

<p>
工业物联网设备，则是通过 MQTT 传输到能源管理平台，通过 MQTT-OPC UA 网关转为 OPC UA 地址空间信息提供给应用程序读取。
</p>
